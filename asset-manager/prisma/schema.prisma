// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url      = env("DATABASE_URL")
}

model Account {
  id        Int      @id @default(autoincrement())
  name      String
  type      String   // BANK, STOCK, CRYPTO
  currency  String   @default("HKD")
  balance   Decimal  @default(0) // Cached total balance in native currency? Or calculated?
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  
  transactions Transaction[]
}

model Asset {
  id        Int      @id @default(autoincrement())
  symbol    String   @unique // AAPL, BTC, USD
  name      String?
  type      String   // STOCK, CRYPTO, FIAT
  
  transactions Transaction[]
  prices       PriceHistory[]
}

model Transaction {
  id        Int      @id @default(autoincrement())
  date      DateTime
  type      String   // BUY, SELL, DEPOSIT, WITHDRAW, INTEREST, DIVIDEND, FEE
  status    String   @default("COMPLETED") // PENDING, COMPLETED, FAILED
  
  accountId Int
  account   Account @relation(fields: [accountId], references: [id])
  
  assetId   Int?
  asset     Asset?   @relation(fields: [assetId], references: [id])
  
  quantity  Decimal? // For asset trades (e.g. +10 AAPL)
  price     Decimal? // Price per unit
  fee       Decimal? // Transaction fee
  total     Decimal? // Total cash impact (e.g. -1500 USD)
  
  notes     String?
  
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model PriceHistory {
  id        Int      @id @default(autoincrement())
  assetId   Int
  asset     Asset    @relation(fields: [assetId], references: [id])
  date      DateTime
  price     Decimal
  
  @@unique([assetId, date])
}
